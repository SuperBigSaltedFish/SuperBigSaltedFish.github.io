<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="CSS," />





  <link rel="alternate" href="/atom.xml" title="夹缝" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="译者的话　　这是一篇译文，对 inline 和 inline-block 的元素剖析非常给力。　　原文：Deep dive CSS: font metrics, line-height and vertical-align - Vincent De Oliveira
前言　　line-height 和 vertical-align 都是简单的 CSS 属性，以致于大多数人自以为知道这两个属性的工作">
<meta property="og:type" content="article">
<meta property="og:title" content="【转载】深入理解CSS：字体宽度、line-height和vertical-align">
<meta property="og:url" content="http://jasonzou.me/2017/05/26/【转载】深入理解CSS：字体宽度、line-height和vertical-align/index.html">
<meta property="og:site_name" content="夹缝">
<meta property="og:description" content="译者的话　　这是一篇译文，对 inline 和 inline-block 的元素剖析非常给力。　　原文：Deep dive CSS: font metrics, line-height and vertical-align - Vincent De Oliveira
前言　　line-height 和 vertical-align 都是简单的 CSS 属性，以致于大多数人自以为知道这两个属性的工作">
<meta property="og:image" content="https://pic3.zhimg.com/v2-ff69639abd00ebd75258a583963df65a_b.png">
<meta property="og:image" content="https://pic3.zhimg.com/v2-c563ed710d244632fc7a734f52f33e7e_b.png">
<meta property="og:image" content="https://pic1.zhimg.com/v2-4c684524b8d37789295f6db964201c74_b.png">
<meta property="og:image" content="https://pic4.zhimg.com/v2-7f1590fecc2f79484b22f38e2869d83b_b.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/v2-8fa5fa46b571db21c79bda208d6263c3_b.png">
<meta property="og:image" content="https://pic4.zhimg.com/v2-cb05dd4dc6908e522c0f69392ed1fe87_b.png">
<meta property="og:image" content="https://pic4.zhimg.com/v2-cc56c718642f701c3f8739ee7a4453cf_b.png">
<meta property="og:image" content="https://pic4.zhimg.com/v2-efe30b60d553cb6237f9c0cbdebb240b_b.png">
<meta property="og:image" content="https://pic3.zhimg.com/v2-0301a379ebf7d2dfcbb995c4a2cfc7fa_b.png">
<meta property="og:image" content="https://pic4.zhimg.com/v2-924b688268ae43ff1c6ccda3bec78123_b.png">
<meta property="og:image" content="https://pic4.zhimg.com/v2-8fa5fa46b571db21c79bda208d6263c3_b.png">
<meta property="og:image" content="https://pic2.zhimg.com/v2-01f0ec3f893c7162af0b6104cfc304e5_b.png">
<meta property="og:image" content="https://pic4.zhimg.com/v2-4a182cd5a309f5b689c95ca730c0ae4f_b.png">
<meta property="og:image" content="https://pic4.zhimg.com/v2-d310ad9f4882c1466a1cf11dee3f20ab_b.png">
<meta property="og:image" content="https://pic1.zhimg.com/v2-f96851b7a279b35a12dea987bae3bff0_b.png">
<meta property="og:image" content="https://pic2.zhimg.com/v2-c4550a3a0387a2dd7fd323bd9e98ccf5_b.png">
<meta property="og:image" content="https://pic2.zhimg.com/v2-c72edc431fa40ef60a890895a3b7a53d_b.png">
<meta property="og:image" content="https://pic4.zhimg.com/v2-a98593192b4f3ab90d9cabf93d390d63_b.png">
<meta property="og:image" content="https://pic2.zhimg.com/v2-58a9a7710e144601bc632c629983bb6d_b.png">
<meta property="og:updated_time" content="2017-05-26T09:40:01.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【转载】深入理解CSS：字体宽度、line-height和vertical-align">
<meta name="twitter:description" content="译者的话　　这是一篇译文，对 inline 和 inline-block 的元素剖析非常给力。　　原文：Deep dive CSS: font metrics, line-height and vertical-align - Vincent De Oliveira
前言　　line-height 和 vertical-align 都是简单的 CSS 属性，以致于大多数人自以为知道这两个属性的工作">
<meta name="twitter:image" content="https://pic3.zhimg.com/v2-ff69639abd00ebd75258a583963df65a_b.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://jasonzou.me/2017/05/26/【转载】深入理解CSS：字体宽度、line-height和vertical-align/"/>





  <title> 【转载】深入理解CSS：字体宽度、line-height和vertical-align | 夹缝 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">夹缝</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://jasonzou.me/2017/05/26/【转载】深入理解CSS：字体宽度、line-height和vertical-align/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason Zou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/timg.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="夹缝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                【转载】深入理解CSS：字体宽度、line-height和vertical-align
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-26T15:53:29+08:00">
                2017-05-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端和-JavaScript-知识总结/" itemprop="url" rel="index">
                    <span itemprop="name">前端和 JavaScript 知识总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="译者的话"><a href="#译者的话" class="headerlink" title="译者的话"></a>译者的话</h3><p>　　这是一篇译文，对 inline 和 inline-block 的元素剖析非常给力。<br>　　原文：<a href="http://iamvdo.me/en/blog/css-font-metrics-line-height-and-vertical-align" target="_blank" rel="external">Deep dive CSS: font metrics, line-height and vertical-align - Vincent De Oliveira</a></p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>　　line-height 和 vertical-align 都是简单的 CSS 属性，以致于大多数人自以为知道这两个属性的工作原理。但实际上这两个属性非常复杂，也许算得上是 CSS 里最难的两个属性，因为这两个属性和 CSS 里一个鲜为人知的特性息息相关：内联格式化上下文（IFC）（译者注：和 BFC 相对应）。</p>
<p>　　举例来说，line-height 的值可以是一个长度（length）或者是一个数字，它的默认值是 normal。那么，normal 是什么呢？我们经常将 normal 理解为 1，或者 1.2，甚至连 CSS 规格文档都没有提到这一问题。我们知道 line-height 的值为数字时，表示的相对于 font-size 的倍数，但问题在于，font-size:100px 对应的文字在不同字体里的高度是不一样的！那么 line-height 会随着文字大小的改变而改变吗？ normal 真的表示 1 或者 1.2 吗？vertical-align 又是如何被 line-height 影响的呢？</p>
<p>　　让我们来深入理解一个不那么简单的 CSS 机制。</p>
<h3 id="font-size"><a href="#font-size" class="headerlink" title="font-size"></a>font-size</h3><p>　　下面是一段简单的 HTML 代码，一个 p 标签包含了 3 个 span 标签，每个 span 各自有一个 font-family：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"a"</span>&gt;</span>Ba<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"b"</span>&gt;</span>Ba<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"c"</span>&gt;</span>Ba<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">p</span> &#123; <span class="attribute">font-size</span>: <span class="number">100px</span> &#125;</div><div class="line"><span class="selector-class">.a</span> &#123; <span class="attribute">font-family</span>: Helvetica &#125;</div><div class="line"><span class="selector-class">.b</span> &#123; <span class="attribute">font-family</span>: Gruppo    &#125;</div><div class="line"><span class="selector-class">.c</span> &#123; <span class="attribute">font-family</span>: Catamaran &#125;</div></pre></td></tr></table></figure>
<p>（译者注：这几款字体你的电脑上可能没有）</p>
<p>　　font-size 相同，font-family 不同，得到的 span 元素的高度也不同：</p>
<p><img src="https://pic3.zhimg.com/v2-ff69639abd00ebd75258a583963df65a_b.png" alt="展示"></p>
<p>　　为什么 font-size: 100px 不能得到相同高度的元素呢？我测量了一下每个 span 的高度：Helvetica 115px，Gruppo 97px，Catamaran 164px。</p>
<p><img src="https://pic3.zhimg.com/v2-c563ed710d244632fc7a734f52f33e7e_b.png" alt="展示2"></p>
<p>　　乍看很奇怪，但是仔细想想，这么做又是很有道理的。原因在于字体本身，这是字体的原理：</p>
<ul>
<li>一款字体会定义一个 em-square，它是用来盛放字符的金属容器。这个 em-square 一般被设定为宽高均为 1000 相对单位，不过也可以是 1024、2048 相对单位。<br><img src="https://pic1.zhimg.com/v2-4c684524b8d37789295f6db964201c74_b.png" alt="展示3"></li>
<li><p>字体度量都是基于这个相对单位设置的，包括 ascender、descender、capital height、x-height 等。注意这里面的值是允许相对于 em-square 出血（bleed outside）的（译者注：大概可以理解为超出 em-square）<br><img src="https://pic4.zhimg.com/v2-7f1590fecc2f79484b22f38e2869d83b_b.jpg" alt="展示4"></p>
</li>
<li><p>在浏览器中，，上面的 1000 相对单位会按照你需要的 font-size 缩放。<br>我们把 Catamaran 字体放到 FontForge 中，分析它的字体度量：</p>
<ul>
<li>em-square 是 1000</li>
<li>ascender 是 1100，descender 是 540。通过测试发现，macOS 上的浏览器使用了 HHead Ascent 和 HHead Descent 值，Windows 上的浏览器使用了 Win Ascent 和 Win Descent（而且两个平台上的值不一样）。我们还看到 Capital Height 是 680，X height 是 485。<br><img src="https://pic4.zhimg.com/v2-8fa5fa46b571db21c79bda208d6263c3_b.png" alt="展示5"></li>
</ul>
</li>
</ul>
<p>　　这意味着 Catamaran 字体占据了 1100 + 540 个相对单位，尽管它的 em-square 只有 1000 个相对单位，所以当我们设置 font-size:100px 时，这个字体里的文字高度是 164px。这个计算出来的高度决定了 HTML 元素的 content-area（内容区域），后面我会讲到 content-area。你可以认为 content-area 就是 background 作用的区域。</p>
<p>　　我们还能看出大写字母的高度是 68px，小写字母的高度（x-height）是 49px。所以 1ex = 49px，1em = 100px，而不是 164px。（真好，em 是基于 font-size，而不是基于计算出来的高度）</p>
<p><img src="https://pic4.zhimg.com/v2-cb05dd4dc6908e522c0f69392ed1fe87_b.png" alt="展示6"></p>
<p>　　在继续深入之前，说点相关的知识。当 p 元素出现在屏幕上时，它可能包含了多行内容，每行内容由多个内联元素组成（内联标签或者是包含文本的匿名内联元素），每一行都叫做一个 line-box。line-box 的高度是由它所有子元素的高度计算得出的。浏览器会计算这一行里每个子元素的高度，再得出 line-box 的高度（具体来说就是从子元素的最高点到最低点的高度），所以默认情况下，一个 line-box 总是有足够的高度来容纳它的子元素。</p>
<pre><code>每个 HTML 元素实际上都是由多个 line-box 的容器组成的，
如果你知道每个 line-box 的高度，那么你就知道了整个元素的高度。
</code></pre><p>如果我们修改一下最初的 HTML 代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">    Good design will be better.</div><div class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"a"</span>&gt;</span>Ba<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"b"</span>&gt;</span>Ba<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"c"</span>&gt;</span>Ba<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">    We get to make a consequence.</div><div class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure>
<p>那么就会得到 3 个 line-box（宽度固定）：</p>
<ul>
<li>第一行和最后一行各有一个匿名内联元素（文本内容）</li>
<li>中间一行包含两个匿名内联元素和三个 span</li>
</ul>
<p><img src="https://pic4.zhimg.com/v2-cc56c718642f701c3f8739ee7a4453cf_b.png" alt="展示7"></p>
<p>　　我们清楚地看到第二个 line-box 比其他两个要高一些。因为第二行里面的子元素因为有一个用到了 Catamaran 字体的 span。</p>
<p>　　line-box 的难点在于我们看不见它，而且不能用 CSS 控制它。即使我们用 ::first-line 给第一行加上背景色，我们也看不出第一个 line-box 的高度。</p>
<h3 id="line-height"><a href="#line-height" class="headerlink" title="line-height"></a>line-height</h3><p>　　目前我已经提到了两个概念：content-area 和 line-box。如果你仔细看了，会发现我说 line-box 的高度是根据子元素的高度计算出来的，而不是子元素的 content-area 的高度。这个区别大了。</p>
<p>　　接下来说句听起来很奇怪的话：一个内联元素有两个高度：content-area 高度和 virtual-area （实际区域？）高度（virtual-area 是我自己发明的单词，它表示对人类有效的高度，你在其他地方是看不到这个单词的）。</p>
<p>　　content-area 的高度是由字体度量定义的（见上文）<br>　　vitual-area 的高度就是 line-height，这个高度用于计算 line-box 的高度</p>
<p><img src="https://pic4.zhimg.com/v2-efe30b60d553cb6237f9c0cbdebb240b_b.png" alt="展示8"></p>
<p>　　这么一来，这就打破了一个长久的谣言：line-height 表示两个 baseline 之间的距离。在 CSS 里，不是这样的。</p>
<p><img src="https://pic3.zhimg.com/v2-0301a379ebf7d2dfcbb995c4a2cfc7fa_b.png" alt="展示9"></p>
<p>　　virtual-area 和 content-area 高度的差异叫做 leading。leading 的一半会被加到 content-area 顶部，另一半会被加到底部。因此 content-area 总是处于 virtual-area 的中间。</p>
<p>　　计算出来的 line-height（也就是 virtual-area 的高度）可以等于、大于或小于 content-area。如果 virtual-area 小于 content-area，那么 leading 就是负的，因此 line-box 看起来就比内容还矮了。</p>
<p>　　还有一些其他种类的内联元素：</p>
<ul>
<li>可替换的内联元素，如 img / input / svg 等</li>
<li>inline-block 元素，以及所有 display 值以 inline- 开头的元素，如 inline-table / inline-flex</li>
<li>处于某种特殊格式化上下文的内联元素，例如 flexbox 元素中的子元素都处于 flex formatting context（弹性格式化上下文）中，这些子元素的 display 值都是「blockified」</li>
</ul>
<p>　　这类内联元素，其高度是基于 height、margin 和 border 属性（译者注：好像漏了 padding）。如果你将其 height 设置为 auto 的话，那么其高度的取值就是 line-height，其 content-area 的取值也是 line-height。</p>
<p><img src="https://pic4.zhimg.com/v2-924b688268ae43ff1c6ccda3bec78123_b.png" alt="展示10"></p>
<p>　　我们目前依然没有解释 line-height:normal 是什么意思。要解答这个问题，我们又得回到 content-area 高度的计算了，问题的答案就在字体度量里面。</p>
<p>　　我们回到 FontForge，Catamaran 的 em-square 高度是 1000，同时我们还看到很多其他的 ascender/descender 值：</p>
<p><img src="https://pic4.zhimg.com/v2-8fa5fa46b571db21c79bda208d6263c3_b.png" alt="展示11"></p>
<ul>
<li>常规的 Ascent/Descent：ascender 是 770，descender 是 230，用于渲染字符。</li>
<li>规格 Ascent/Descent：ascender 是 1100，descender 是 540。用于计算 content-area 的高度</li>
<li>规格 Line Gap：用于计算 line-height: normal。</li>
</ul>
<p>　　在 Catamaran 这款字体中，Line Gap 的值是 0，那么 line-height: normal 的结果就跟 content-area 的高度一样，是 1640 相对单位。</p>
<p>　　为了对比，我们再看看 Arial 字体，它的 em-square 是 2048，ascender 是 1854，descender 是 434，line gap 是 67。那么当 font-size: 100px 时，</p>
<ul>
<li>其 content-area 的高度就是 100/2048*(1854+434) = 111.72，约为 112px；</li>
<li>其 line-height: normal 的结果就是 100/2048*(67+1854+434) 约为 115px。</li>
</ul>
<p>　　所有这些值都是由字体设计师设置的。</p>
<p>　　这么看来，line-height:1 就是一个很糟糕的实践。记得吗，当 line-height 的值是一个数字时，其实就是相对 font-size 的倍数，而不是相对于 content-area。所以 line-height:1 很有可能使得 virtual-area 比 content-area 矮，从而引发很多其他的问题。</p>
<p><img src="https://pic2.zhimg.com/v2-01f0ec3f893c7162af0b6104cfc304e5_b.png" alt="展示12"></p>
<p>　　不仅仅是 line-height:1 有问题，我电脑上的 1117 款字体中，大概有 1059 款字体的 line-height 比 1 大，最低的是 0.618，最高的是 3.378。你没看错，是 3.378！</p>
<p>　　line-box 计算的一些细节：</p>
<ul>
<li>对于内联元素，padding 和 border 会增大 background 区域，但是不会增大 content-area（不是 line-box 的高度）。一般来说你无法再屏幕上看到 content-area。margin-top 和 margin-bottom 对两者都没有影响。</li>
<li>对于可替换内联元素（replaced inline elements）、inline-block 元素和 blockified 内联元素，padding、margin 和 border 会增大 height（译者注：注意 margin），因此会影响 content-area 和 line-box 的高度</li>
</ul>
<h3 id="vertical-align"><a href="#vertical-align" class="headerlink" title="vertical-align"></a>vertical-align</h3><p>　　我还没提过 vertical-align 属性，它也是计算 line-box 高度的重要因素之一。我们甚至可以说 vertical-align 是内联格式化上下文（IFC）中最重要的属性。</p>
<p>　　它的默认值是 baseline。还记得字体度量里的 ascender 和 descender 吗？这两个值决定了 baseline 的位置。很少有</p>
<p>　　字体的 ascender 和 descender 的比例是一比一的，所以我们经常看到一些意想不到的现象，下面是例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>Ba<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>Ba<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">p</span> &#123;</div><div class="line">    <span class="attribute">font-family</span>: Catamaran;</div><div class="line">    <span class="attribute">font-size</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">line-height</span>: <span class="number">200px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>　　一个 p 标签内有两个 span 标签，span 继承了 font-family、font-size 和 200px 的 line-height。这时两个 span 的 baseline 是等高的，line-box 的高度就是 span 的 line-height。</p>
<p><img src="https://pic4.zhimg.com/v2-4a182cd5a309f5b689c95ca730c0ae4f_b.png" alt="展示13"></p>
<p>如果第二个 span 的 font-size 变小了呢？</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">span</span><span class="selector-pseudo">:last-child</span> &#123;</div><div class="line">    <span class="attribute">font-size</span>: <span class="number">50px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>　　我们会发现一个非常奇怪的现象，line-box 的高度变高了！如下图所示。提示你一下，line-box 的高度是从子元素的最高点到最低点的举例。</p>
<p><img src="https://pic4.zhimg.com/v2-d310ad9f4882c1466a1cf11dee3f20ab_b.png" alt="展示14"></p>
<p>　　这个例子可以作为「应该将 line-height 的值写成数字」的论据，但是有时候我们为了做出好看的排版，必须把 line-height 写成一个固定值。</p>
<p>　　不过我实话告诉你吧，不管你把 line-height 写成什么，你都会在对齐内联元素的时候遇到麻烦。</p>
<p>　　我们来看另一个例子。p 标签有 line-height:200px，内含一个 span，span 继承了 p 的 line-height。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>Ba<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">p</span> &#123;</div><div class="line">    <span class="attribute">line-height</span>: <span class="number">200px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">span</span> &#123;</div><div class="line">    <span class="attribute">font-family</span>: Catamaran;</div><div class="line">    <span class="attribute">font-size</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>　　此时 line-box 的高度是多少？貌似是 200px，但其实不是。这里你没有考虑到的问题是 p 有自己的 font-family，默认值是 serif。p 的 baseline 和 span 的 baseline 位置不一样，因此最终的 line-box 比我们预想的要高一些。出现这种问题是因为浏览器认为每个 line-box 的起始位置都有一个宽度为 0 的字符（CSS 文档将其称为 strut），并将其纳入 line-box 的高度的计算中。</p>
<pre><code>看不见的字符，看得见的影响。
</code></pre><p>　　为了说明这个问题，我们画图解释一下这个问题。<br><img src="https://pic1.zhimg.com/v2-f96851b7a279b35a12dea987bae3bff0_b.png" alt="展示15"></p>
<p>　　用 baseline 来对齐令人费解，如果我们用 vertical-align: middle 会不会好一点呢？读 CSS 文档你会发现，middle 的意思是「用父元素 baseline 高度加上父元素中 x-height 的一半的高度来对齐当前元素的垂直方向的中点」。baseline 所处的高度跟字体有关，x-height 的高度也跟字体有关，所以 middle 对齐也不靠谱。更糟糕的是，一般来说，middle 根本就不是居中对齐！内联元素的对齐受太多因素影响，因此不可能用 CSS 实现。</p>
<p>顺便一说，vertical-align 的其他 4 个值有可能有点用：</p>
<ul>
<li>vertical-align: top / bottom，表示与 line-box 的顶部或底部对齐</li>
<li>vertical-align: text-top / text-bottom，表示与 content-area 的顶部或底部对齐<br><img src="https://pic2.zhimg.com/v2-c4550a3a0387a2dd7fd323bd9e98ccf5_b.png" alt="展示16"></li>
</ul>
<p>不过你依然要小心，大部分情况下，对齐的是 virtual-area，也就是一个不可见的高度。看看下面这个用 vertical-align:top 的例子：<br><img src="https://pic2.zhimg.com/v2-c72edc431fa40ef60a890895a3b7a53d_b.png" alt="展示17"></p>
<p>最后，vertical-align 的值也可以是数字，表示根据 baseline 升高或降低，不到万不得已还是别用数字吧。</p>
<h3 id="CSS-is-awesome"><a href="#CSS-is-awesome" class="headerlink" title="CSS is awesome"></a>CSS is awesome</h3><p>　　我们讨论了 line-height 和 vertical-align 如果互相影响，现在问题来了：CSS 可以控制字体度量吗？简单来说答案是：不行。我也很想用 CSS 来控制字体。无论怎样，我还是想试试。字体度量只是一些固定的值而已，我们应该可以围绕它做点什么。</p>
<p>　　比如说，我们想要一段文字使用 Catamaran 字体，同时大写字母的高度正好是 100px，看起来可以实现，我们只需要一些数学知识。</p>
<p>　　首先我们把所有字体度量设置为 CSS 自定义属性，然后计算出一个 font-size，让大写字母的高度正好是 100px。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">p</span> &#123;</div><div class="line">    <span class="comment">/* font metrics */</span></div><div class="line">    <span class="attribute">--font</span>: Catamaran;</div><div class="line">    <span class="attribute">--fm-capitalHeight</span>: <span class="number">0.68</span>;</div><div class="line">    <span class="attribute">--fm-descender</span>: <span class="number">0.54</span>;</div><div class="line">    <span class="attribute">--fm-ascender</span>: <span class="number">1.1</span>;</div><div class="line">    <span class="attribute">--fm-linegap</span>: <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* desired font-size for capital height */</span></div><div class="line">    <span class="attribute">--capital-height</span>: <span class="number">100</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* apply font-family */</span></div><div class="line">    <span class="attribute">font-family</span>: <span class="built_in">var</span>(--font);</div><div class="line"></div><div class="line">    <span class="comment">/* compute font-size to get capital height equal desired font-size */</span></div><div class="line">    <span class="attribute">--computedFontSize</span>: (<span class="built_in">var</span>(--capital-height) / <span class="built_in">var</span>(--fm-capitalHeight));</div><div class="line">    <span class="attribute">font-size</span>: <span class="built_in">calc</span>(var(--computedFontSize) * <span class="number">1px</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="https://pic4.zhimg.com/v2-a98593192b4f3ab90d9cabf93d390d63_b.png" alt="展示18"></p>
<p>　　看起来也并不复杂不是吗？如果我们想要文字垂直居中怎么办呢？也就是让 B 上面的空间和下面的空间高度一样。为了做到这一点，我们必须要根据 ascender 和 descender 的比例来计算 vertical-align。</p>
<p>　　首先计算出 line-height:normal 的值和 content-area 的高度：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">p &#123;</div><div class="line">    …</div><div class="line">    --lineheightNormal: (var(--fm-ascender) + var(--fm-descender) + var(--fm-linegap));</div><div class="line">    --contentArea: (var(--lineheightNormal) * var(--computedFontSize));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后我们需要计算：</p>
<ul>
<li>B 下面空间的高度</li>
<li>B 上面空间的高度</li>
</ul>
<p>像这样：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">p &#123;</div><div class="line">    …</div><div class="line">    --distanceBottom: (var(--fm-descender));</div><div class="line">    --distanceTop: (var(--fm-ascender) - var(--fm-capitalHeight));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后我们就可以计算 vertical-align 的值。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">p &#123;</div><div class="line">    …</div><div class="line">    --valign: ((var(--distanceBottom) - var(--distanceTop)) * var(--computedFontSize));</div><div class="line">&#125;</div><div class="line">span &#123;</div><div class="line">    vertical-align: calc(var(--valign) * -1px);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后，设置 line-height：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">p &#123;</div><div class="line">    …</div><div class="line">    /* desired line-height */</div><div class="line">    --line-height: 3;</div><div class="line">    line-height: calc(((var(--line-height) * var(--capital-height)) - var(--valign)) * 1px);</div><div class="line">&#125;</div><div class="line">```	</div><div class="line">![展示19](https://pic1.zhimg.com/v2-86b09b1ecc3a6c745bcb2d096e8edeec_b.png)</div><div class="line"></div><div class="line">添加一个和 B 一样高的 icon 就很容易了：</div><div class="line"></div><div class="line">``` CSS</div><div class="line">span::before &#123;</div><div class="line">    content: '';</div><div class="line">    display: inline-block;</div><div class="line">    width: calc(1px * var(--capital-height));</div><div class="line">    height: calc(1px * var(--capital-height));</div><div class="line">    margin-right: 10px;</div><div class="line">    background: url('https://cdn.pbrd.co/images/yBAKn5bbv.png');</div><div class="line">    background-size: cover;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="https://pic2.zhimg.com/v2-58a9a7710e144601bc632c629983bb6d_b.png" alt="展示20"></p>
<p><a href="http://jsbin.com/tufatir/edit?css,output" target="_blank" rel="external">jsbin 演示效果</a></p>
<p>注意这只是为了演示，请不要在生产环境中使用此方案。</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>我们知道了：</p>
<ul>
<li>IFC 真的很难懂</li>
<li>所有的内联元素都有两个高度<ul>
<li>基于字体度量的 content-area</li>
<li>virtual-area（也就是 line-height ）</li>
<li>这两个高度你都无法看到</li>
</ul>
</li>
<li>line-height: normal 是基于字体度量计算出来的</li>
<li>line-height: n (n=1,2,3…) 可能得出一个比 virtual-area 还要矮的 content-area</li>
<li>vertical-align 不靠谱</li>
<li>line-box 的高度的受其子元素的 line-height 和 vertical-align 的影响</li>
<li>我们无法轻易的用 CSS 来控制字体度量<br>但是我依然喜欢 CSS ：）</li>
</ul>
<p style="text-align: center;"><b>… End …</b></p>
















      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/CSS/" rel="tag"># CSS</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/12/入门函数式编程/" rel="next" title="入门函数式编程">
                <i class="fa fa-chevron-left"></i> 入门函数式编程
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/05/29/加州招待所-神雕乐队/" rel="prev" title="加州招待所-神雕乐队">
                加州招待所-神雕乐队 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8yODMxOC80ODkw"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/timg.jpg"
               alt="Jason Zou" />
          <p class="site-author-name" itemprop="name">Jason Zou</p>
           
              <p class="site-description motion-element" itemprop="description">偶尔写代码的厨子</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/SuperBigSaltedFish" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://zerosrat.com/" title="Zero Yu 的博客" target="_blank">Zero Yu 的博客</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#译者的话"><span class="nav-number">1.</span> <span class="nav-text">译者的话</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#前言"><span class="nav-number">2.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#font-size"><span class="nav-number">3.</span> <span class="nav-text">font-size</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#line-height"><span class="nav-number">4.</span> <span class="nav-text">line-height</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vertical-align"><span class="nav-number">5.</span> <span class="nav-text">vertical-align</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSS-is-awesome"><span class="nav-number">6.</span> <span class="nav-text">CSS is awesome</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#结论"><span class="nav-number">7.</span> <span class="nav-text">结论</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason Zou</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  






  





  

  

  

  

</body>
</html>
